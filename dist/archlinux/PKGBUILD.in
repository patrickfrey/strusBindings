# Contributor: Patrick Frey <patrickpfrey@yahoo.com> 
# Maintainer: Patrick Frey <patrickpfrey@yahoo.com> 

pkgbase=strusbindings
pkgname=(strusbindings-php7 strusbindings-lua strusbindings-python3)
_deppkgver=@STRUS_MAJOR_VERSION@.@STRUS_MINOR_VERSION@
_mainpkgver=@STRUS_VERSION@
pkgver=${_mainpkgver}
pkgrel=1
pkgdesc='Language bindings for the strus text search engine.'
license=('MPL2')
arch=('i686' 'x86_64')
url="http://project-strus.net"
depends=('boost>=1.53' 'boost-libs>=1.53' "strus>=${_deppkgver}" "strusanalyzer>=${_deppkgver}" "strustrace>=${_deppkgver}" "strusmodule>=${_deppkgver}" "strusrpc>=${_deppkgver}")
makedepends=('cmake' 'php7' 'python3')
source=("${pkgbase}-${_mainpkgver}.tar.gz")

build() {
  cd ${srcdir}/${pkgbase}-${_mainpkgver}

  msg "Building..."
  mkdir build
  cd build
  cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release -DLIB_INSTALL_DIR=lib \
	-DWITH_PHP="YES" -DWITH_PYTHON="YES" \
	-DPYTHON_LIBRARY=/usr/bin/python3 -DPYTHON_INCLUDE_DIR=/usr/include/python3 \
	..
  make
}

package_strusbindings-php7() {
  cd ${srcdir}/${pkgbase}-${_mainpkgver}

  msg "Installing Php7 bindings.."
  cd build

  cd src/lang/php7
  make DESTDIR=${pkgdir} install
  cd ../../..
  
  mkdir -p ${pkgdir}/usr/share/php7
  cp src/lang/php7/strus.php ${pkgdir}/usr/share/php7/.

  mkdir -p ${pkgdir}/etc/php7/conf.d
  cp src/lang/php7/php.ini ${pkgdir}/etc/php7/conf.d/
}

package_strusbindings-python3() {
  cd ${srcdir}/${pkgbase}-${_mainpkgver}
  
  msg "Installing Python3 bindings.."
  cd build
  cd src/lang/python3
  make DESTDIR=${pkgdir} install
  cd ../../..
}

package_strusbindings-lua() {
  cd ${srcdir}/${pkgbase}-${_mainpkgver}
  
  msg "Installing Lua bindings.."
  cd build
  cd src/lang/lua
  make DESTDIR=${pkgdir} install
  cd ../../..
}

check() {
  cd ${srcdir}/${pkgbase}-${_mainpkgver}

  msg "Testing..."
  cd build
  make test
}

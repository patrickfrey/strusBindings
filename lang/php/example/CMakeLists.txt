cmake_minimum_required( VERSION 2.8 FATAL_ERROR )

set( THISDIR "${PROJECT_SOURCE_DIR}/lang/php/example" )
set( tests helloWorld createCollection query query_trace queryexpr status )
IF (WITH_STRUS_PATTERN STREQUAL "YES")
set( tests ${tests} querypattern )
ENDIF (WITH_STRUS_PATTERN STREQUAL "YES")
IF (WITH_STRUS_VECTOR STREQUAL "YES")
set( tests ${tests} vectors )
ENDIF (WITH_STRUS_VECTOR STREQUAL "YES")

foreach( test ${tests} )
	add_test( NAME php_${test} COMMAND ${PHP_EXECUTABLE} -c ../php.ini ${test}.php WORKING_DIRECTORY ${THISDIR} )
	if(APPLE OR WIN32)
		set_tests_properties( php_${test} PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php/${CMAKE_BUILD_TYPE}" )
	else(APPLE OR WIN32)
		set_tests_properties( php_${test} PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
	endif(APPLE OR WIN32)
endforeach( test )

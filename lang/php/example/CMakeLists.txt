cmake_minimum_required( VERSION 2.6 FATAL_ERROR )

set( THISDIR "${PROJECT_SOURCE_DIR}/lang/php/example" )
set( tests helloWorld createCollection query query_trace queryexpr status )
IF (WITH_STRUS_PATTERN STREQUAL "YES")
set( tests ${tests} querypattern )
ENDIF (WITH_STRUS_PATTERN STREQUAL "YES")
IF (WITH_STRUS_VECTOR STREQUAL "YES")
set( tests ${tests} vectors )
ENDIF (WITH_STRUS_VECTOR STREQUAL "YES")

if( CMAKE_MAJOR_VERSION GREATER 2 OR CMAKE_MINOR_VERSION GREATER 6 )
	foreach( test ${tests} )
		add_test( NAME php_${test} COMMAND ${PHP_EXECUTABLE} -c ../php.ini ${test}.php WORKING_DIRECTORY ${THISDIR} )
		if(APPLE OR WIN32)
			set_tests_properties( php_${test} PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php/${CMAKE_BUILD_TYPE}" )
		else(APPLE OR WIN32)
			set_tests_properties( php_${test} PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
		endif(APPLE OR WIN32)
	endforeach( test )
else( CMAKE_MAJOR_VERSION GREATER 2 OR CMAKE_MINOR_VERSION GREATER 6 )
	add_test( php_helloWorld ${PHP_EXECUTABLE} -c ../php.ini helloWorld.php WORKING_DIRECTORY ${THISDIR} )
	add_test( php_createCollection ${PHP_EXECUTABLE} -c ../php.ini createCollection.php WORKING_DIRECTORY ${THISDIR} )
	add_test( php_query ${PHP_EXECUTABLE} -c ../php.ini query.php WORKING_DIRECTORY ${THISDIR} )
	add_test( php_query_trace ${PHP_EXECUTABLE} -c ../php.ini query_trace.php WORKING_DIRECTORY ${THISDIR} )
	add_test( php_queryexpr ${PHP_EXECUTABLE} -c ../php.ini queryexpr.php WORKING_DIRECTORY ${THISDIR} )
	add_test( php_status ${PHP_EXECUTABLE} -c ../php.ini status.php WORKING_DIRECTORY ${THISDIR} )
IF (WITH_STRUS_VECTOR STREQUAL "YES")
	add_test( php_vectors ${PHP_EXECUTABLE} -c ../php.ini vectors.php WORKING_DIRECTORY ${THISDIR} )
ENDIF (WITH_STRUS_VECTOR STREQUAL "YES")
IF (WITH_STRUS_PATTERN STREQUAL "YES")
	add_test( php_querypattern ${PHP_EXECUTABLE} -c ../php.ini querypattern.php WORKING_DIRECTORY ${THISDIR} )
ENDIF (WITH_STRUS_PATTERN STREQUAL "YES")
	set_tests_properties( php_helloWorld PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
	set_tests_properties( php_createCollection PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
	set_tests_properties( php_query PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
	set_tests_properties( php_query_trace PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
	set_tests_properties( php_queryexpr PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
	set_tests_properties( php_status PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
IF (WITH_STRUS_VECTOR STREQUAL "YES")
	set_tests_properties( php_vectors PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
ENDIF (WITH_STRUS_VECTOR STREQUAL "YES")
IF (WITH_STRUS_PATTERN STREQUAL "YES")
	set_tests_properties( php_querypattern PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${PROJECT_SOURCE_DIR}/lang/php" )
ENDIF (WITH_STRUS_PATTERN STREQUAL "YES")
endif( CMAKE_MAJOR_VERSION GREATER 2 OR CMAKE_MINOR_VERSION GREATER 6 )

